function checkSyncWall(){var e=readCookie(g_SESSION_ID_TAG);if(!e||e=="null"){e=""}g_PAGEURL=window.location;log("g_PAGEURL: "+g_PAGEURL);var f=getAuthToken(g_PAGEURL);if(f!=""){createCookie(g_AUTHTOKEN,f,36500,"/");var g=g_PAGEURL.toString().indexOf("sp-tk");g_PAGEURL=g_PAGEURL.toString().substr(0,g)}var f=readCookie(g_AUTHTOKEN);if(!f||f=="null"){f=""}var a;var c=document.getElementsByName("__sync_contentCategory");if(c&&c[0]){a=c[0].content;log("contentId: "+a)}else{return}var d=referringDomain(document.referrer);log("referrer: "+d);log("encoded referrer:"+document.referrer);var b=getMyStarId();log("recentlyVisited: "+recentlyVisited(g_PAGEURL.toString()));if(!recentlyVisited(g_PAGEURL.toString())){callServer(e,f,a,b,d,g_PAGEURL,"serverCallback")}else{createCookie(g_HISTORY,updateHistory(g_PAGEURL.toString()),36500,"/")}}function getMyStarId(){var a=readCookie("user_id");if(!a||a=="null"){a=""}return a}function hideElementById(b){var a=document.getElementById(b);if(a){a.className+=" .hide"}}function hideTorStarLinks(){var a=(getMyStarId()!="");if(a){hideElementById("sync-login-link")}}function recentlyVisited(c){return false;if(g_DEBUG){return false}var a=pageHistory();if(a==null){return false}var d=a.indexOf(c);if(d==-1){return false}var b=a[d+1];if(timeDiff(new Date().getTime(),b)>g_REFRESHTIMELIMIT){return false}return true}function pageHistory(){var a=readCookie(g_HISTORY);if(!a||a=="null"){return null}return a.split(",")}function timeDiff(a,c){var b=a-c;var d=Math.floor(b/60000);return d}function updateHistory(b){var a=pageHistory();var c=-1;if(a!=null){c=a.indexOf(b)}if(c==-1){if(a==null){a=new Array()}if((a.length/2)>=g_REFRESHLIMIT){replaceOldest(a,b)}else{a.push(b);a.push(new Date().getTime())}}else{a.splice(c+1,1,new Date().getTime())}return a.join(",")}function replaceOldest(a,e){var c=new Date("12/31/2199").getTime();var d=-1;for(var b=1;b<a.length;b+=2){if(a[b]<c){c=a[b];d=b}}if(d>0){a.splice(d-1,2,e,new Date().getTime())}else{a.push(e);a.push(new Date().getTime())}}function getAuthToken(b){var a=getParameterByName("sp-tk");log("auth-token: "+a);return a}function getParameterByName(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)";var b=new RegExp(c);var d=b.exec(window.location.search);if(d==null){return""}else{return decodeURIComponent(d[1].replace(/\+/g," "))}}function referringDomain(b){var c=b.split("/");var a="";if(c.length>2){a="http://"+c[2]+"/foo.htm"}return a}function callServer(o,a,g,i,l,j,d){var p=encodeURI(o);var f=encodeURIComponent(g);var h=encodeURIComponent(i);var m=encodeURIComponent(l);var k=encodeURIComponent(j);var e=encodeURIComponent(d);var b=encodeURIComponent(a);var c="https://www.syncaccess.net/po/tstar/api/svcs/meter";var n=c+"?sessionId="+p+"&contentId="+f+"&externalId="+h+"&referrer="+m+"&page="+k+"&authToken="+b+"&callback="+e+"&nocache="+new Date().getTime();log("serverURL: "+n);InsertScriptElement(n)}function InsertScriptElement(c){var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("src",c);log("script: "+b.outerHTML);var a=document.getElementsByTagName("head").item(0);if(!a){a=document.getElementsByTagName("body").item(0)}a.appendChild(b)}function serverCallback(c){var a=c.authorized.toLowerCase();var e=c.sessionIdentifier;var d=c.overlayContent;var b=c.authToken;var f=c.showWarning;log("serverCallback Data:");log("    authorized:  "+a);log("    sessionId:   "+e);log("    authToken:   "+b);log("    showWarning: "+f);log("    overlayContent:\n"+d);if(a!="true"){displayOverlay(d);if(f=="true"){createCookie(g_HISTORY,updateHistory(g_PAGEURL.toString()),36500,"/")}}else{createCookie(g_HISTORY,updateHistory(g_PAGEURL.toString()),36500,"/")}createCookie(g_SESSION_ID_TAG,e,36500,"/");if(b&&b!=""){createCookie(g_AUTHTOKEN,b,36500,"/")}}function createCookie(d,f,b,e){var c;if(b){var a=new Date();a.setTime(a.getTime()+(b*24*60*60*1000));c="; expires="+a.toGMTString()}else{c=""}document.cookie=d+"="+f+c+"; path="+e+";"}function readCookie(e){var f=e+"=";log(document.cookie);var b=document.cookie.split(";");for(var d=0;d<b.length;d++){var a=b[d];while(a.charAt(0)==" "){a=a.substring(1,a.length)}if(a.indexOf(f)==0){return a.substring(f.length,a.length)}}return null}function eraseCookie(a){createCookie(a,"",-1)}function forceCookie(){var a=document.getElementById("cookieVal");if(a){var b=a.value;createCookie(g_SESSION_ID_TAG,b,1)}}function loadCustomStyleSheet(b){var a=document.getElementsByTagName("head").item(0);var c=document.createElement("link");c.type="text/css";c.rel="stylesheet";c.href=b;c.setAttribute("id","_customCss_");a.appendChild(c)}function displayOverlay(overlayContent){if(g_DEBUG){overlayContent+='<br><input type="button" value="Reset Cookie" onclick="eraseCookie(\''+g_SESSION_ID_TAG+"'); return false;\" />";overlayContent+='<br /><input type="text" id="cookieVal" value="" /><input id="setCookieBut" type="button" value="Set Cookie" onclick="forceCookie();return false;" />'}var body=document.getElementsByTagName("body").item(0);loadCustomStyleSheet("https://www.syncaccess.net/po/tstar/api/scripts/syncwallstyle");var oDiv=document.createElement("div");oDiv.setAttribute("id","syncronexOverlay");oDiv.setAttribute("class","syncronex-overlay");body.appendChild(oDiv);var ocDiv=document.createElement("div");ocDiv.setAttribute("id","syncronexOverlayContent");oDiv.setAttribute("class","syncronex-overlay-content");ocDiv.innerHTML=overlayContent;body.appendChild(ocDiv);hideTorStarLinks();var bStyle=body.style;bStyle.height="100%";bStyle.margin=0;bStyle.padding=0;var oStyle=document.getElementById("syncronexOverlay").style;oStyle.visibility="visible";oStyle.position="fixed";oStyle.left="0px";oStyle.top="0px";oStyle.width="100%";oStyle.height="100%";oStyle.zIndex=2147483647;oStyle.backgroundColor="#313131";oStyle.opacity=".95";oStyle.filter="alpha(opacity=95)";oStyle.MozOpacity=".95";var ocStyle=document.getElementById("syncronexOverlayContent").style;ocStyle.visibility="visible";ocStyle.position="fixed";var viewPort=GetWindowSize();var absoluteWidth=600;var absoluteHeight=400;ocStyle.left=eval((viewPort.Width-absoluteWidth)/2)+"px";ocStyle.top=eval((viewPort.Height-absoluteHeight)/2)+"px";ocStyle.width=absoluteWidth+"px";ocStyle.height=absoluteHeight+"px";ocStyle.margin="auto";ocStyle.backgroundColor="#FFFFFF";ocStyle.border="5px solid #ddd";ocStyle.padding="2px";ocStyle.zIndex=2147483647;ocStyle.opacity="1";ocStyle.filter="alpha(opacity=100)";ocStyle.MozOpacity="1";ocStyle.color="#000000";ocStyle.fontFamily="Arial, Helvetica, sans-serif";ocStyle.fontWeight="normal"}function GetWindowSize(){var a={Width:0,Height:0};if(typeof(window.innerWidth)=="number"){a.Width=window.innerWidth;a.Height=window.innerHeight}else{if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){a.Width=document.documentElement.clientWidth;a.Height=document.documentElement.clientHeight}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){a.Width=document.body.clientWidth;a.Height=document.body.clientHeight}}}return a}function log(a){if(g_DEBUG){if(window.console&&window.console.log){console.log(a)}}}function dismissOverlay(){var b=document.getElementById("syncronexOverlay");var c=document.getElementById("syncronexOverlayContent");var a=document.getElementById("_customCss_");if(typeof c!="undefined"){removeElement(c)}if(typeof b!="undefined"){removeElement(b)}if(typeof a!="undefined"){removeElement(a)}}function removeElement(a){a.parentNode.removeChild(a)}var g_SESSION_ID_TAG="syncwall-sessionid";var g_AUTHTOKEN="syncwall-authToken";var g_HISTORY="syncwall-history";var g_REFRESHLIMIT=1;var g_REFRESHTIMELIMIT=0;var g_PAGEURL;var g_DEBUG=false;if(g_DEBUG){g_REFRESHLIMIT=1;g_REFRESHTIMELIMIT=0}if(window.addEventListener){window.addEventListener("load",checkSyncWall,false)}else{if(window.attachEvent){window.attachEvent("onload",checkSyncWall)}};