/**
 * Copyright 2013 SlimSurveys, Inc.
 *
 * Version: 1.4.0 (2013-11-08 22:30:00 UTC)
 * Author: Daniel Marashlian - @danielzev
 * Description: These are echo enabled SlimSurveys plugins written for the Realtidbits comment widget
 */
(function(c){var b=c;var a=Echo.Plugin.manifest("SlimSurveys","Echo.StreamServer.Controls.Submit");if(Echo.Plugin.isDefined(a)){return}a.config={slim:"https://rapidengage.com",cdn:"https://8a894ed82966de594302-db6813f2295a29da7ae1834f8bc01832.ssl.cf1.rackcdn.com/rtb/",apikey:"aac560e7-5b12-0000-56cd-3cff562312aa"};a.labels={slim_tooltip:"Create a Poll",slim_title:"Create Poll",slim_builder_header:"Multiple Choice Question",slim_builder_question:"Enter your question here",slim_builder_option:"Enter your answer here",slim_preview_header:"Preview Poll",slim_preview_question:"Your question will be displayed here",slim_preview_option:"Your answer will be displayed here",slim_add_option:"Add an answer",slim_error_form:"You must add a question and at least two answers to create a poll",slim_error_server:"Uh-oh, something went wrong when creating your poll. Please try again."};a.templates.survey_button='<a class="{plugin.class:survey_button} navbar-btn echo-clickable" title="{plugin.label:slim_tooltip}"><i class="icon-slimsurveys-poll"></i></a>';a.templates.survey_preview='<div class="{plugin.class:survey_preview}"></div>';a.templates.survey_uid="";a.init=function(){var d=this;d.extendTemplate("insertAfter","body",a.templates.survey_preview);d.extendTemplate("insertBefore","postContainer",a.templates.survey_button);b(document).on("click",".slimsurveys-poweredby.ref",function(){window.open(d.config.get("slim"))})};a.renderers.survey_button=function(e){var d=this;e.click(function(){d._openPollBuilder()});return e};a.renderers.survey_preview=function(d){d.hide()};a.methods._openPollBuilder=function(){var d=this;var e=new Echo.GUI.Modal({'extraClass':'slimsurveys-builder-body',fade:true,width:665,height:320,footer:true,header:true,closeButton:true,data:{title:d.labels.get("slim_title")+'&nbsp;&nbsp;<a href="'+d.config.get("slim")+'/support/realtidbits" target="_blank"><i class="icon-question-sign"></i></a>',body:function(){var f=[];var j=[];var q=[];j.push(b("<p><strong>"+d.labels.get("slim_builder_header")+"</strong></p>"));var k=b('<input type="text" placeholder="'+d.labels.get("slim_builder_question")+'" name="question" maxlength="70" data-option-count="2" />');k.on("keyup",function(s){var i=b(this).val();if(i){b("#survey .question p").text(i)}else{b("#survey .question p").text(d.labels.get("slim_preview_question"))}});j.push(k);for(var l=0;l<5;l++){var h=b('<div class="option"></div>');var m=null;if(l>1){h.css("display","none")}var r=b('<div class="input-append"></div>');m=b('<input type="text" placeholder="'+d.labels.get("slim_builder_option")+'" name="option['+l+']" class="option" maxlength="30" rel="'+l+'" />');m.on("keypress",function(t){var i=(t.keyCode?t.keyCode:t.which);if(i==13){var s=true;b("#surveyForm div.option:visible .option").each(function(){var u=b.trim(b(this).val());if(!u){s=false;b(this).focus();return false}});if(s){b("#add-option").click()}}});m.on("keyup",function(s){var i=b(this).val();if(i){b("#survey .answers .answer[rel="+b(this).attr("rel")+"]").text(i)}else{b("#survey .answers .answer[rel="+b(this).attr("rel")+"]").text(d.labels.get("slim_preview_option"))}});var o=b('<button class="btn remove" type="button" tabindex="-1" rel="'+l+'"><i class="icon-remove"></i></button>');o.on("click",function(s){s.preventDefault();g.show();var i=b('#surveyForm input[name="question"]').attr("data-option-count");b('#surveyForm input[name="question"]').attr("data-option-count",i-1);b(this).parent().parent().fadeOut(function(){b(this).find(".option").val("")});b("#survey .answers .answer[rel="+b(this).attr("rel")+"]").fadeOut(function(){b(this).text(d.labels.get("slim_preview_option"))})});r.append(m);r.append(o);h.append(r);j.push(h)}var g=b('<p><a id="add-option" href="#" class="btn">'+d.labels.get("slim_add_option")+"</a></p>");g.on("click",function(t){t.preventDefault();var s=b("#surveyForm div.option:visible").length;if(s<5){if(s==4){g.hide()}b('#surveyForm input[name="question"]').attr("data-option-count",s+1);var i=b("#surveyForm div.option:hidden:first .option").attr("rel");b(".option[rel="+i+"]").parent().parent().fadeIn();b(".option[rel="+i+"]").focus();b("#survey .answers .answer[rel="+i+"]").fadeIn()}});j.push(g);q.push(b("<p><strong>"+d.labels.get("slim_preview_header")+'</strong></p><div id="survey"><div class="question"><p>'+d.labels.get("slim_preview_question")+'</p><ul class="answers unstyled"><li class="answer" rel="0">'+d.labels.get("slim_preview_option")+'</li><li class="answer" rel="1">'+d.labels.get("slim_preview_option")+'</li><li class="answer" rel="2" style="display: none;">'+d.labels.get("slim_preview_option")+'</li><li class="answer" rel="3" style="display: none;">'+d.labels.get("slim_preview_option")+'</li><li class="answer" rel="4" style="display: none;">'+d.labels.get("slim_preview_option")+"</li></ul></div></div>"));q.push(b('<div class="slimsurveys-poweredby"></div>'));var n=b('<form id="surveyForm"></form>').append(j);var p=b('<div id="live_preview"></div>').append(q);f.push(b('<div class="alert alert-error hide"><span></span></div>'));f.push(n);f.push(p);return b('<div id="slimsurveys-builder"></div>').append(f)},buttons:[{title:d.labels.get("slim_title"),handler:function(){var f=b.trim(b('input[name="question"]').val());var g=0;b("#surveyForm div.option .option").each(function(){var h=b.trim(b(this).val());if(h){g++}});if(f&&g>=2){d.view.get("survey_button").hide();d.view.get("survey_button").parent().next().hide();d._createPoll(e)}else{b(".modal-body").css("height",380);b("#slimsurveys-builder .alert").find("span").text(d.labels.get("slim_error_form"));b("#slimsurveys-builder .alert").fadeIn()}}}]},onShow:function(){b('input[name="question"]').focus()}});e.show();e.element.click(function(f){f.stopPropagation()})};a.methods._createPoll=function(e){var d=this;b.ajax({url:d.config.get("slim")+"/api/rtb",type:"POST",data:b("#surveyForm").serialize()+"&X-API-KEY="+d.config.get("apikey"),success:function(h){var f=h.uid;var g='<iframe width="300" height="250" src="'+d.config.get("slim")+"/survey/"+f+'/embed" frameborder="0" scrolling="no" allowTransparency="true" async="true"></iframe>';var i='<div class="slimsurveys-poweredby"></div>';e.hide();d.view.get("survey_preview").append(g+i);d.view.get("survey_preview").slideDown();a.templates.survey_uid=f},error:function(){b(".modal-body").css("height",380);b("#slimsurveys-builder .alert").find("span").text(d.labels.get("slim_error_server"));b("#slimsurveys-builder .alert").fadeIn()}})};a.events={"Echo.StreamServer.Controls.Submit.onPostInit":function(d,e){if(a.templates.survey_uid){var f=e.postData.content[0].object.content;f+='<div class="echo-item-files">';f+='<div class="slimsurveys-wrapper" data-uid="'+a.templates.survey_uid+'"></div>';f+="</div>";e.postData.content[0].object.content=f}},"Echo.StreamServer.Controls.Submit.onPostComplete":function(e,f){if(a.templates.survey_uid){var d=this;a.templates.survey_uid="";d.view.get("survey_preview").slideUp().empty();d.view.get("survey_button").show();d.view.get("survey_button").parent().next().show()}}};a.css='.modal-header .icon-question-sign { margin-top: 3px !important; }.echo-sdk-ui.rtb-apps-comments [class^="icon-slimsurveys-"] { background: url("'+a.config.cdn+'poll.png") no-repeat 0 0; height: 16px; width: 16px; }#surveyForm { border-right: 1px solid #eee; float: left; margin: 0 0 -10px 15px; min-height: 320px; width: 274px; }#surveyForm .alert { margin-right: 30px; }#live_preview { float: right; margin-right: 15px; }#live_preview #survey { background-color: #fafafa; border: 1px solid #000; height: 228px; margin-bottom: 6px; overflow: hidden; padding: 10px; position: relative; text-align: left; width: 278px; }#live_preview #survey > div { height: 228px; left: 10px; overflow: hidden; position: absolute; top: 10px; width: 278px; }#live_preview #survey .question .answers { left: 0; margin: 0; position: absolute; top: 50px; width: 260px; }#live_preview #survey .question .answers .answer { background-color: #fff; -moz-border-radius: 4px; -webkit-border-radius: 4px; border-radius: 4px; border: 1px solid #9f9e9d; color: #9f9e9d; margin-bottom: 7px; padding: 4px 8px; width: 100%; }#live_preview #survey .question .answers .answer:hover { background-color: #00aef3; border-color: #00aef3; color: #fff; cursor: pointer; }#add-option { background: #00aef3; color: #fff; margin-top: 10px; text-shadow: none; }input[name="question"] { width: 230px !important; }input[type="text"].option { margin-left: 0; width: 191px; }.{plugin.class:survey_preview} { background-color: #f4f4f4; border-bottom: 1px dashed #ddd; border-top: 0; border: 1px solid #ccc; color: #00aef3; font-weight: bold; margin-top: 0; padding: 10px; text-shadow: 0 1px 1px white; }.slimsurveys-wrapper { min-height: 256px; padding-top: 20px; }.slimsurveys-poweredby { background: url("'+a.config.cdn+'powered.png"); background-size: 100px 29px; height: 29px !important; margin-top: 4px; width: 100px !important; }.slimsurveys-poweredby.ref { cursor: pointer; }#slimsurveys-builder p { font: normal 14px/14px "Helvetica Neue",Helvetica,Arial,sans-serif; }.slimsurveys-builder-body, .slimsurveys-builder-body * { -moz-box-sizing: content-box; -webkit-box-sizing: content-box; box-sizing: content-box; }';Echo.Plugin.create(a)})(Echo.jQuery);
(function(c){var b=c;var a=Echo.Plugin.manifest("SlimSurveysItems","Echo.StreamServer.Controls.Stream.Item");if(Echo.Plugin.isDefined(a)){return}a.config={slim:"https://rapidengage.com"};a.component.renderers.text=function(f){this.parentRenderer("text",arguments);var e=this;var h=f.find(".slimsurveys-wrapper");if(h.length>0){var d=h.data("uid");var g='<iframe width="300" height="250" src="'+e.config.get("slim")+"/survey/"+d+'/embed" frameborder="0" scrolling="no" allowTransparency="true" async="true"></iframe>';var i='<div class="slimsurveys-poweredby ref">';h.html(g+i)}return f};Echo.Plugin.create(a)})(Echo.jQuery);
