/*!CK:3224994873!*//*1383526665,173224797*/

if (self.CavalryLogger) { CavalryLogger.start_js(["masB4"]); }

__d("OauthLogin",["Cookie","Dialog","PopupWindow","URI","WindowComm","XD","tx"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('Dialog'),i=b('PopupWindow'),j=b('URI'),k=b('WindowComm'),l=b('XD').XD,m=b('tx');function n(o,p){this.provider=o;this.endpoint=p;return this;}n.prototype.login=function(o,p,q){var r=k.makeHandler(function(u){this._closePopup();var v=this.provider+'..'+u.oauth_token+'..'+u.oauth_token_secret;g.set('tpa',v,0,'/');if(q)n._refreshLoginStatus();o&&o();}.bind(this)),s=k.makeHandler(function(u){this._closePopup();new h().setTitle("Ruh roh!").setBody(m._("We're having trouble talking to {provider}.\u003Cbr \/>Either login to Facebook directly or try again later.",{provider:this.provider})).setHandler(function(){p&&p();}).setButtons(h.OK).show();}.bind(this)),t=new j(this.endpoint);t.setQueryData({provider:this.provider,next:r,channel_url:s,cancel_url:s,display:'popup'});this._popup=i.open(t.toString(),416,468);};n.prototype._closePopup=function(){if(this._popup){this._popup.close();this._popup=null;}};n._refreshLoginStatus=function(){try{l.send({type:'refreshThirdPartyAuthStatus'});}catch(o){window.location.reload();}};e.exports=n;});
__d("OpenIDLogin",["Cookie","Dialog","OpenIDRequest","XD","tx"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('Dialog'),i=b('OpenIDRequest'),j=b('XD').XD,k=b('tx'),l={login:function(m,n,o,p,q){i.context='tpa';new i().setThirdPartyLogin(true).setSuccessHandler(function(r){var s='OpenID'+'..'+r.oid+'..'+r.secret;g.set('tpa',s,0,'/');if(!!p)l._refreshLoginStatus();n&&n();}).setErrorHandler(function(r){new h().setTitle("Ruh roh!").setBody(k._("We're having trouble talking to {provider}.\u003Cbr \/>Either login to Facebook directly or try again later.",{provider:m})).setButtons(h.OK).setHandler(function(){o&&o();}).show();}).setProviderCache(q).setOpenIDUrl(m).send();},_refreshLoginStatus:function(){try{j.send({type:'refreshThirdPartyAuthStatus'});}catch(m){window.location.reload();}}};e.exports=l;});
__d("MultiLoginPopup",["Arbiter","CommentAdminPanelController","CSS","Dialog","DOM","DTSG","Env","Event","HTML","OauthLogin","OpenIDLogin","PopupWindow","SelectorDeprecated","URI","WidgetArbiter","WindowComm","$","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CommentAdminPanelController'),i=b('CSS'),j=b('Dialog'),k=b('DOM'),l=b('DTSG'),m=b('Env'),n=b('Event'),o=b('HTML'),p=b('OauthLogin'),q=b('OpenIDLogin'),r=b('PopupWindow'),s=b('SelectorDeprecated'),t=b('URI'),u=b('WidgetArbiter'),v=b('WindowComm'),w=b('$'),x=b('copyProperties'),y={provider:'facebook',providerCache:{},formSubmissionInterceptors:[],init:function(){g.subscribe('platform/socialplugins/login',function(z){y.loggedIn=!!z.user;});s.subscribe('close',function(z,aa){s.setSelected(aa.selector,s.getValue(aa.selector),false);});},setProvider:function(z){y.provider=z;return this;},setProviderCache:function(z){y.providerCache=z;return this;},interceptFormSubmission:function(z,aa,ba,ca){var da=function(ea){if(ea){y.detachExistingSubmissionInterceptors();if(ea.fbDtsg){l.setToken(ea.fbDtsg);m.user=ea.user;}if(ea.isThirdParty==="0"){k.scry(document.documentElement,'.postToProfile').forEach(function(fa){i.show(fa);});k.scry(document.documentElement,'.postToProfileCheckbox').forEach(function(fa){if(ea.postToProfileChecked==="0"){fa.removeAttribute('checked');}else fa.setAttribute('checked','checked');});k.scry(document.documentElement,'.viewerProfileHref').forEach(function(fa){fa.href=ea.profileUrl;fa.onclick='';});k.scry(document.documentElement,'.commentas').forEach(function(fa){var ga=fa.id;k.replace(fa,o(ea.commentAsMarkup));var ha=w(ea.commentAsMarkupID);ha.id=ga;var ia=k.scry(ha,'a.commentaschange');if(ia.length==1){var ja=ia[0],ka=new t(ja.getAttribute('ajaxify'));ka.addQueryData({uniqid:ga});ja.setAttribute('ajaxify',ka.toString());}});}else k.scry(document.documentElement,'.commentas').forEach(function(fa){var ga=fa.id;k.replace(fa,o(ea.commentAsMarkup));var ha=w(ea.commentAsMarkupID);ha.id=ga;});k.scry(document.documentElement,'.viewerProfilePic').forEach(function(fa){fa.src=ea.profilePic;});k.scry(document.documentElement,'.fbCommentAfterLoginButton').forEach(i.hide);k.scry(document.documentElement,'.fbCommentButton').forEach(i.show);k.scry(document.documentElement,'.fbReplyAfterLoginButton').forEach(i.hide);k.scry(document.documentElement,'.fbReplyButton').forEach(i.show);k.scry(document.documentElement,'.fbUpDownVoteAfterLogin').forEach(i.hide);k.scry(document.documentElement,'.fbUpDownVoteOption').forEach(i.show);k.scry(document.documentElement,'.closeButtonAfterLogin').forEach(i.hide);k.scry(document.documentElement,'.closeButton').forEach(i.show);h.setLoggedIn(parseInt(ea.user,10));g.inform('platform/socialplugins/login',{user:ea.user},g.BEHAVIOR_STATE);u.inform('platform/socialplugins/login',{user:ea.user},g.BEHAVIOR_STATE);}};y.login(ca,z,aa,ba,da);return false;},attachAllFormsToLogin:function(z,aa){y.formSubmissionInterceptors=[];y.popupTitle=z;y.params=aa;y.reattachLoginInterceptors();},reattachLoginInterceptors:function(){y.detachExistingSubmissionInterceptors();var z=['composer','fbUpDownVoteAfterLogin','closeButtonAfterLogin'],aa=y.popupTitle,ba=y.params,ca=function(ea){var fa=ea.getTarget();if(fa.tagName.toLowerCase()==='form'&&z.some(i.hasClass.curry(fa)))return y.interceptFormSubmission(fa,aa,ba);},da=n.listen(document.body,'submit',ca,n.Priority.URGENT);y.formSubmissionInterceptors.push(da);},detachExistingSubmissionInterceptors:function(){var z=y.formSubmissionInterceptors.length;for(var aa=0;aa<z;aa++)y.formSubmissionInterceptors[aa].remove();y.formSubmissionInterceptors=[];},login:function(z,aa,ba,ca,da){if(!y.loggedIn)y._openPopup(ca,da);},doOpenIDLogin:function(z,aa,ba){q.login(z,y.tpaLoginCallback(aa),y.tpaLoginCallback(ba),false,y.providerCache);},doOauthWrapLogin:function(z,aa,ba){var ca=new p(z,'/connect/oauthwrap_login.php');return ca.login(y.tpaLoginCallback(aa),y.tpaLoginCallback(ba),false);},doTwitterLogin:function(z,aa){var ba=new p('Twitter','/connect/twitter_login.php');return ba.login();},tpaLoginCallback:function(z){return function(aa,ba){var ca=k.create('iframe',{src:aa,className:'hidden_elem'});k.appendContent(k.find(ba.documentElement,'body'),ca);}.curry(z,document);},loggedIn:false,_popup:null,_openPopup:function(z,aa){var ba=y.provider==='facebook'?'opener':'parent',ca=v.makeHandler(function(ka){y._closePopup();aa&&aa(ka);},ba),da=v.makeHandler(function(ka){y._closePopup();},ba),ea;ea=new t('/plugins/multi_login_popup_loggedin.php');ea.setQueryData({original_next:ca,original_cancel:da,iframe_src:z.iframe_src});ca=ea.getQualifiedURI().toString();if(y.provider==='facebook'){ea=new t('/login.php');ea.setQueryData(x(z,{social_plugin:'multi_login',cancel_url:da,next:ca,provider:y.provider}));var fa=450,ga=700;this._popup=r.open(ea.toString(),fa,ga);}else if(y.provider==='twitter'){y.doTwitterLogin(ca,da);}else if(y.provider==='microsoft'){y.doOauthWrapLogin(y.provider,ca,da);}else if(y.provider==='openid'){var ha=new j(),ia=function(ka){var la=ha.getFormData();y.doOpenIDLogin(la.openid_url,ca,da);ha.hide();if(ka.kill)ka.kill();return false;};ha.setContentWidth(350).setTitle('OpenID').setBody(k.create('form',{onsubmit:ia},k.create('input',{type:'text',size:60,name:'openid_url'}))).setHandler(ia).setButtons([j.CONFIRM,j.CANCEL]).show();}else{var ja=y.provider+'.com';y.doOpenIDLogin(ja,ca,da);}},_closePopup:function(){if(this._popup){this._popup.close();this._popup=null;}}};e.exports=y;});
__d("legacy:multi-login-popup",["MultiLoginPopup"],function(a,b,c,d){a.MultiLoginPopup=b('MultiLoginPopup');},3);