(function(){this.SingleWork={preview_controller:null,register_preview_view:function(t,e){return this.preview_controller.register_view(t,e)},show_preview:function(t){return this.preview_controller.show(t)},expand_preview:function(){return this.preview_controller.expand()},unexpand_preview:function(){return this.preview_controller.unexpand()}}}).call(this),function(){SingleWork.AttachmentsViewer=function(){function t(t){this.$el=t.el,this._find_elements(),this._setup_events(),$a.is_logged_in()||this._make_sticky(),this.initialize()}return t.prototype.elements={inner_wrapper:".inner_wrapper",attachments:".attachments",attachment_links:"li.attachment.previewable",collapse_button:".collapse_sidebar_button",expand_button:".expand_sidebar_button"},t.prototype.initialize=function(){var t=this;return this._show_initial_attachment(),this.$els.attachment_links.on("click",function(e){return $(e.target).hasClass("icon")?void 0:t.show_attachment($(e.currentTarget))})},t.prototype._find_elements=function(){var t=this;return this.$els={},_.each(this.elements,function(e,n){return t.$els[n]=t.$el.find(e)})},t.prototype._setup_events=function(){var t=this;return this.$els.collapse_button.on("click",function(e){return t.collapse_sidebar(e)}),this.$els.expand_button.on("click",function(e){return t.expand_sidebar(e)})},t.prototype._make_sticky=function(){var t,e,n,i;return e=this.$el.find(".inner_wrapper"),n=$(".previews"),i=null,t=_.throttle(function(){return i=n.offset().top},500),$(document).scroll(function(){return t(),window.pageYOffset+20>i?e.addClass("sticky"):e.removeClass("sticky")})},t.prototype.show_attachment=function(t){var e;return t.data("previewable")?(e=t.data("index"),this.$els.attachment_links.removeClass("on"),t.addClass("on"),SingleWork.show_preview(t.data("attachment")),this._set_hash(t.data("index"))):void 0},t.prototype.collapse_sidebar=function(t){return t.preventDefault(),this.$els.inner_wrapper.hide(),this.$els.expand_button.show(),SingleWork.expand_preview()},t.prototype.expand_sidebar=function(t){return t.preventDefault(),SingleWork.unexpand_preview(),this.$els.expand_button.hide(),this.$els.inner_wrapper.show()},t.prototype._show_initial_attachment=function(){var t,e;return e=parseInt(JSRoutes.getHashPath(),10),(!e||isNaN(e))&&(e=0),t=this.$els.attachment_links.get(e),t||(t=this.$els.attachment_links.first()),this.show_attachment($(t))},t.prototype._set_hash=function(t){return 0!==parseInt(t,10)?JSRoutes.setHashPath(t):JSRoutes.getHashPath()?JSRoutes.setHashPath(""):void 0},t}()}.call(this),function(){SingleWork.CsvView=function(){function t(t){this.container=t.container,this.identifier=t.identifier,this.attachment_id=t.attachment_id,this.$container=$(this.container),this.content=null}return t.prototype.show=function(){var t,e=this;return this.$container.find(".info").hide(),this.$container.find(".csv_preview_loader").show(),null!==this.content?this.$container.html(this.content):(t=$r.attachment_csv_preview_path({attachment_id:this.attachment_id}),$.ajax({url:t,dataType:"json",success:function(t){return e.content=t.content,e.$container.html(e.content)},error:function(){return e.$container.find(".csv_preview_loader").hide(),e.$container.find(".info").show()}}))},t.prototype.expand=function(){return this.$container.addClass("full_width")},t.prototype.unexpand=function(){return this.$container.removeClass("full_width")},t}()}.call(this),function(){SingleWork.IFrameView=function(){function t(t){this.container=t.container,this.identifier=t.identifier,this.$container=$(this.container)}return t.prototype.expand=function(){return this.$container.addClass("full_width")},t.prototype.unexpand=function(){return this.$container.removeClass("full_width")},t}()}.call(this),function(){SingleWork.PreviewController=function(){function t(){this.views={},this.current_identifier=null}return t.prototype.show=function(t){return this.current_identifier&&this._hide_view(this.current_identifier),this.current_identifier=t,this._show_view(t)},t.prototype.register_view=function(t,e){if(null!=this.views[t])throw"Can't register multiple views for the same identifier!";return this.views[t]=e,this.current_identifier===t?this._show_view(t):void 0},t.prototype.expand=function(){var t;return null!=(t=this.views[this.current_identifier])?"function"==typeof t.expand?t.expand():void 0:void 0},t.prototype.unexpand=function(){var t;return null!=(t=this.views[this.current_identifier])?"function"==typeof t.unexpand?t.unexpand():void 0:void 0},t.prototype._show_view=function(t){var e;return this._view_container(t).show(),null!=(e=this.views[t])?"function"==typeof e.show?e.show():void 0:void 0},t.prototype._hide_view=function(t){var e;return null!=(e=this.views[t])&&"function"==typeof e.tear_down&&e.tear_down(),this._view_container(t).hide()},t.prototype._view_container=function(t){return $(".attachment_preview[data-attachment="+t+"]")},t}(),SingleWork.preview_controller=new SingleWork.PreviewController}.call(this),function(){SingleWork.RepoView=function(){function t(t){var e=this;this._set_repo_widths(),_.each(this.constructor_options,function(n){return e[n]=t[n]}),this.$container=$(this.container)}return t.prototype.constructor_options=["container","user","repo","identifier"],t.prototype.defaults={expanded:"966px",unexpanded:"760px"},t.prototype.show=function(){var t=this;return $a.ie8()?this.unsupported_browser():req("repo",function(){return t.$container.append("<div class='inner_repo'></div>"),t.$repo=t.$container.find(".inner_repo"),t.$repo.width(t.defaults.unexpanded),t.$repo.repo({user:t.user,name:t.repo}),t.$repo.on("not_found",function(){return t.not_found()}),t.$repo.on("api_limited",function(){return t.api_limited()})})},t.prototype.not_found=function(){var t;return null!=(t=this.$repo)&&t.find(".repo").hide(),this.$container.find(".not_found").show()},t.prototype.api_limited=function(){var t;return null!=(t=this.$repo)&&t.find(".repo").hide(),this.$container.find(".api_limited").show()},t.prototype.unsupported_browser=function(){var t;return null!=(t=this.$repo)&&t.find(".repo").hide(),this.$container.find(".unsupported_browser").show()},t.prototype.expand=function(){return this.$repo.width(this.defaults.expanded)},t.prototype.unexpand=function(){return this.$repo.width(this.defaults.unexpanded)},t.prototype.tear_down=function(){return this.$repo.remove()},t.prototype._set_repo_widths=function(){var t;return t=$("#site").attr("class").replace("fixed","").trim(),"w_1160"===t?(this.defaults.expanded="1060px",this.defaults.unexpanded="880px"):"w_1340"===t?(this.defaults.expanded="1246px",this.defaults.unexpanded="1050px"):"w_1780"===t?(this.defaults.expanded="1680px",this.defaults.unexpanded="1500px"):void 0},t}()}.call(this),function(){SingleWork.ScribdDocumentView=function(){function t(t){var e=this;this._set_zoom_levels(),_.each(this.constructor_options,function(n){return e[n]=t[n]}),this.$container=$(this.container),this.scribd_document=null}return t.prototype.constructor_options=["container","attachment_id","scribd_id","scribd_key","identifier","scribd_js_url","is_cv"],t.prototype.defaults={expanded:"1.38",unexpanded:"1.1"},t.prototype.show=function(){var t=this;return req_and_ready(["scribd",this.scribd_js_url],function(){var e;return e="scribd_document_seamless_"+GlobalIncrementor.next(),t._create_inner_element(e),t.scribd_document=ScribdDocController.create({scribd_element:e,document_type:t.is_cv?"cv":"whatever"}),t.scribd_document.show({attachment_id:t.attachment_id,scribd_id:t.scribd_id,scribd_key:t.scribd_key})})},t.prototype.tear_down=function(){var t,e;return null!=(t=this.scribd_document)&&null!=(e=t.scribd_doc)&&e.__remove(),this.scribd_document=null},t.prototype.expand=function(){var t,e;return null!=(t=this.scribd_document)?null!=(e=t.scribd_doc)?e.api.setZoom(this.defaults.expanded):void 0:void 0},t.prototype.unexpand=function(){var t,e;return null!=(t=this.scribd_document)?null!=(e=t.scribd_doc)?e.api.setZoom(this.defaults.unexpanded):void 0:void 0},t.prototype._create_inner_element=function(t){var e;return e=$("<div/>"),e.addClass("scribd_flash"),e.attr("id",t),this.$container.append(e)},t.prototype._set_zoom_levels=function(){var t;return t=$("#site").attr("class").replace("fixed","").trim(),"w_1160"===t?(this.defaults.expanded="1.6",this.defaults.unexpanded="1.32"):"w_1340"===t?(this.defaults.expanded="1.87",this.defaults.unexpanded="1.6"):"w_1780"===t?(this.defaults.expanded="2.5",this.defaults.unexpanded="2.25"):void 0},t}()}.call(this),function(){SingleWork.Responsive=function(){function t(){this._start_tests()&&(this._get_window_width(),this.initialize())}return t.prototype.defaults={tier_1:{width:"1010",zoom:"1.1",zoom_expanded:"1.38","class":"w_1010"},tier_2:{width:"1160",zoom:"1.32",zoom_expanded:"1.6","class":"w_1160"},tier_3:{width:"1340",zoom:"1.6",zoom_expanded:"1.87","class":"w_1340"},tier_4:{width:"1780",zoom:"2.25",zoom_expanded:"2.5","class":"w_1780"}},t.prototype.elements={scribd_document:"#scribd_embedded_doc",site:$("#site")},t.prototype.initialize=function(){var t;return t=this,$(window).resize(function(){return t._get_window_width()})},t.prototype._get_window_width=function(){var t;return t=window.innerWidth-100,this._set_content_width(t)},t.prototype._set_content_width=function(t){return this.elements.site.attr({"class":"fixed"}),t>this.defaults.tier_4.width?this.elements.site.addClass(this.defaults.tier_4["class"]):t>this.defaults.tier_3.width?this.elements.site.addClass(this.defaults.tier_3["class"]):t>this.defaults.tier_2.width?this.elements.site.addClass(this.defaults.tier_2["class"]):void 0},t.prototype._start_tests=function(){return"yes"===Academia.split.start_and_record("responsive","no","yes")?(this._track_time("Responsive"),!0):(this._track_time("NonResponsive"),!1)},t.prototype._track_time=function(t){var e;return $a.is_logged_in()?(e=new MongoLog("Responsiveness",t),e.start(),$(window).unload(function(){return e.finish(t)})):void 0},t}()}.call(this);