(function(){this.AcademiaSharing={}}).call(this),function(){var e,t;e=null,$(document).on("click","*[data-academia-share]",function(a){var r,n,o,s,i,u;if(!e)return e=!0,r=$(a.currentTarget),o=r.attr("data-academia-share"),u=r.attr("data-spinner")||"small_white_hide_contents",s=r.attr("data-reshare-of"),i=Spinner[u](r),n=new AcademiaSharing.Share({target:o,share_id:s}),n.fetch({success:function(){return t(r,i,n)},error:function(){return n.set({message:""}),t(r,i,n)}})}),t=function(t,a,r){return $.get(r.preview_url(),function(n){var o,s;return a.stop(),e=!1,r.set("preview",n),s=new AcademiaSharing.ModalView({model:r,on_share:function(){return $w.flash("Shared with your followers.",{nextTo:t,fadeOutMS:2e3})},on_unshare:function(){return $w.flash("Removed from your followers' news feeds.",{nextTo:t,fadeOutMS:2e3})}}),o=new Widgets.ModalBox({title:"Share With Your Followers",contents:s.render().$el,width:"550px"}),o.show(),s.post_insert()})}}.call(this),function(){var e,t={}.hasOwnProperty,a=function(e,a){function r(){this.constructor=e}for(var n in a)t.call(a,n)&&(e[n]=a[n]);return r.prototype=a.prototype,e.prototype=new r,e.__super__=a.prototype,e};AcademiaSharing.Share=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return a(r,t),r.prototype.modelName="share",r.prototype.routeKey="api_v0_share",r.prototype.initialize=function(){return r.__super__.initialize.apply(this,arguments),this._parse_arx_into_type_and_id()},r.prototype.url=function(e){return"read"===e&&null==this.id?$r.find_api_v0_shares_path({subdomain_param:"api","share[content_type]":this.get("content_type"),"share[content_id]":this.get("content_id")}):r.__super__.url.apply(this,arguments)},r.prototype.preview_url=function(){return $r.html_api_v0_work_path({id:this.get("content_id"),subdomain_param:"api"})},r.prototype.toJSON=function(){return _.omit(this.attributes,"preview","target")},r.prototype._parse_arx_into_type_and_id=function(){var e,t,a;return a=this.get("target").split("/"),t=a[0],e=a[1],this.set({content_type:t,content_id:e})},r}(Academia.Model)}.call(this),function(){this.JST||(this.JST={}),this.JST["academia_sharing/templates/modal_view"]=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){buf.push('<div class="academia_sharing_modal clearfix"><div class="input"><textarea name="message" maxlength="500" class="message">');var __val__=message;buf.push(escape(null==__val__?"":__val__)),buf.push('</textarea></div><div class="work_share_container">');var __val__=preview;buf.push(null==__val__?"":__val__),buf.push('</div><a href="#" style="display: none" class="button red unshare">Remove</a><a href="#" class="button blue save">Share</a><a href="#" class="button light-grey cancel">Cancel</a></div>')}return buf.join("")}}(),function(){var e,t={}.hasOwnProperty,a=function(e,a){function r(){this.constructor=e}for(var n in a)t.call(a,n)&&(e[n]=a[n]);return r.prototype=a.prototype,e.prototype=new r,e.__super__=a.prototype,e};AcademiaSharing.ModalView=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return a(r,t),r.prototype.jstTemplate="academia_sharing/templates/modal_view",r.prototype.elements={input:"textarea",preview:".work_share_container",save_button:".save",cancel_button:".cancel",unshare_button:".unshare"},r.prototype.events={"click %save_button":"handle_save","click %cancel_button":"handle_cancel","click %unshare_button":"handle_unshare"},r.prototype.post_insert=function(){return this.$els.input.magicker_default("Add a message (optional)"),this.model.id?(this.$els.save_button.text("Update"),this.$els.unshare_button.show()):void 0},r.prototype.handle_save=function(e){var t=this;return e.preventDefault(),Spinner.small_white_hide_contents(this.$els.save_button),this.model.save({message:this.$els.input.val()},{success:function(){var e;return t.$el.trigger("hide_modal"),"function"==typeof(e=t.options).on_share?e.on_share():void 0}})},r.prototype.handle_cancel=function(e){return e.preventDefault(),this.$el.trigger("hide_modal")},r.prototype.handle_unshare=function(e){var t=this;return e.preventDefault(),Spinner.small_white_hide_contents(this.$els.unshare_button),this.model.destroy({success:function(){var e;return t.$el.trigger("hide_modal"),"function"==typeof(e=t.options).on_unshare?e.on_unshare():void 0}})},r}(Academia.View)}.call(this);