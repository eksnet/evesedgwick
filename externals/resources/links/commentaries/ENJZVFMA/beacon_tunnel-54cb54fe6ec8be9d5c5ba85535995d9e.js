(function(){window.STR==null&&(window.STR={}),window.STR.BeaconTunnel={Helpers:{},Models:{}}}).call(this),function(){var e=window.base64,t={};t.noConflict=function(){var n=t;return window.base64=e,n},t.PADCHAR="=",t.ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t.getbyte64=function(e,n){var r=t.ALPHA.indexOf(e.charAt(n));if(r==-1)throw"Cannot decode base64";return r},t.decode=function(e){e=""+e;var n=t.getbyte64,r,i,s,o=e.length;if(o==0)return e;if(o%4!=0)throw"Cannot decode base64";r=0,e.charAt(o-1)==t.PADCHAR&&(r=1,e.charAt(o-2)==t.PADCHAR&&(r=2),o-=4);var u=[];for(i=0;i<o;i+=4)s=n(e,i)<<18|n(e,i+1)<<12|n(e,i+2)<<6|n(e,i+3),u.push(String.fromCharCode(s>>16,s>>8&255,s&255));switch(r){case 1:s=n(e,i)<<18|n(e,i+1)<<12|n(e,i+2)<<6,u.push(String.fromCharCode(s>>16,s>>8&255));break;case 2:s=n(e,i)<<18|n(e,i+1)<<12,u.push(String.fromCharCode(s>>16))}return u.join("")},t.getbyte=function(e,t){var n=e.charCodeAt(t);if(n>255)throw"INVALID_CHARACTER_ERR: DOM Exception 5";return n},t.encode=function(e){if(arguments.length!=1)throw"SyntaxError: Not enough arguments";var n=t.PADCHAR,r=t.ALPHA,i=t.getbyte,s,o,u=[];e=""+e;var a=e.length-e.length%3;if(e.length==0)return e;for(s=0;s<a;s+=3)o=i(e,s)<<16|i(e,s+1)<<8|i(e,s+2),u.push(r.charAt(o>>18)),u.push(r.charAt(o>>12&63)),u.push(r.charAt(o>>6&63)),u.push(r.charAt(o&63));switch(e.length-a){case 1:o=i(e,s)<<16,u.push(r.charAt(o>>18)+r.charAt(o>>12&63)+n+n);break;case 2:o=i(e,s)<<16|i(e,s+1)<<8,u.push(r.charAt(o>>18)+r.charAt(o>>12&63)+r.charAt(o>>6&63)+n)}return u.join("")},window.base64=t}(),function(){var e=window.UUID,t=function(){};t.noConflict=function(){var t=window.UUID;return window.UUID=e,t},t.generate=function(){var e=t._getRandomInt,n=t._hexAligner;return n(e(32),8)+"-"+n(e(16),4)+"-"+n(16384|e(12),4)+"-"+n(32768|e(14),4)+"-"+n(e(48),12)},t._getRandomInt=function(e){return e<0?NaN:e<=30?0|Math.random()*(1<<e):e<=53?(0|Math.random()*(1<<30))+(0|Math.random()*(1<<e-30))*(1<<30):NaN},t._getIntAligner=function(e){return function(t,n){var r=t.toString(e),i=n-r.length,s="0";for(;i>0;i>>>=1,s+=s)i&1&&(r=s+r);return r}},t._hexAligner=t._getIntAligner(16),t.FIELD_NAMES=["timeLow","timeMid","timeHiAndVersion","clockSeqHiAndReserved","clockSeqLow","node"],t.FIELD_SIZES=[32,16,16,8,8,48],t.genV4=function(){var e=t._getRandomInt;return(new t)._init(e(32),e(16),16384|e(12),128|e(6),e(8),e(48))},t.parse=function(e){var n,r=/^(?:urn:uuid:|\{)?([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{2})([0-9a-f]{2})-([0-9a-f]{12})(?:\})?$/i;return(n=r.exec(e))?(new t)._init(parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),parseInt(n[4],16),parseInt(n[5],16),parseInt(n[6],16)):null},t.prototype._init=function(){var e=t.FIELD_NAMES,n=t.FIELD_SIZES,r=t._binAligner,i=t._hexAligner;this.intFields=new Array(6),this.bitFields=new Array(6),this.hexFields=new Array(6);for(var s=0;s<6;s++){var o=parseInt(arguments[s]||0);this.intFields[s]=this.intFields[e[s]]=o,this.bitFields[s]=this.bitFields[e[s]]=r(o,n[s]),this.hexFields[s]=this.hexFields[e[s]]=i(o,n[s]/4)}return this.version=this.intFields.timeHiAndVersion>>12&15,this.bitString=this.bitFields.join(""),this.hexString=this.hexFields[0]+"-"+this.hexFields[1]+"-"+this.hexFields[2]+"-"+this.hexFields[3]+this.hexFields[4]+"-"+this.hexFields[5],this.urn="urn:uuid:"+this.hexString,this},t._binAligner=t._getIntAligner(2),t.prototype.toString=function(){return this.hexString},t.prototype.equals=function(e){if(e instanceof t){for(var n=0;n<6;n++)if(this.intFields[n]!==e.intFields[n])return!1;return!0}return!1},t.genV1=function(){var e=(new Date).getTime(),n=t._state;e!=n.timestamp?(e<n.timestamp&&n.sequence++,n.timestamp=e,n.tick=t._getRandomInt(4)):Math.random()<t._tsRatio&&n.tick<9984?n.tick+=1+t._getRandomInt(4):n.sequence++;var r=t._getTimeFieldValues(n.timestamp),i=r.low+n.tick,s=r.hi&4095|4096;n.sequence&=16383;var o=n.sequence>>>8|128,u=n.sequence&255;return(new t)._init(i,r.mid,s,o,u,n.node)},t.resetState=function(){t._state=new t._state.constructor},t._tsRatio=.25,t._state=new function(){var n=t._getRandomInt;this.timestamp=0,this.sequence=n(14),this.node=(n(8)|1)*1099511627776+n(40),this.tick=n(4)},t._getTimeFieldValues=function(e){var t=e-Date.UTC(1582,9,15),n=t/4294967296*1e4&268435455;return{low:(t&268435455)*1e4%4294967296,mid:n&65535,hi:n>>>16,timestamp:t}},t.makeBackwardCompatible=function(){var e=t.generate;t.generate=function(n){return n&&n.version==1?t.genV1().hexString:e.call(t)},t.makeBackwardCompatible=function(){}},window.UUID=t}(),function(){var e;(e=STR.BeaconTunnel).Vendor==null&&(e.Vendor={base64:window.base64.noConflict(),UUID:window.UUID.noConflict()})}.call(this),function(){STR.BeaconTunnel.Helpers.LocalStorageHelper={setValue:function(e,t){return window.localStorage[e]=t},getValue:function(e){return window.localStorage[e]}}}.call(this),function(){STR.BeaconTunnel.Helpers.UIDHelper={getOrSetUID:function(){var e;return e=this.getUID(),e==null&&(e=this.generateUID(),this.setUID(e)),e},getUID:function(){var e;if(STR.BeaconTunnel.Helpers.LocalStorageHelper.getValue("str_notrack")!=null)return"str-notrack";e=STR.BeaconTunnel.Helpers.LocalStorageHelper.getValue("str_i");if(e!=null)return STR.BeaconTunnel.Vendor.base64.decode(e)},generateUID:function(){return STR.BeaconTunnel.Vendor.UUID.generate()},setUID:function(e){var t;return t=STR.BeaconTunnel.Vendor.base64.encode(e),STR.BeaconTunnel.Helpers.LocalStorageHelper.setValue("str_i",t)}}}.call(this),function(){window.STR==null&&(window.STR={}),window.STR.util={isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},defaults:function(e,t){var n,r,i;r={};for(n in e)i=e[n],r[n]=i;for(n in t)i=t[n],r[n]==null&&(r[n]=i);return r}}}.call(this),function(){STR.BeaconTunnel.Models.BeaconCannon=function(){function e(e){this.uid=STR.BeaconTunnel.Helpers.UIDHelper.getOrSetUID(),this.defaultParams={uid:this.uid},this.defaultParams=STR.util.defaults(this.defaultParams,e)}return e.prototype.firePixel=function(e){var t;return t=new Image,t.src=this.replaceCacheBusterParam(e),t},e.prototype.fireBeacon=function(e,t,n){var r,i,s,o;return r=STR.util.defaults(n,this.defaultParams),r.umtime=(new Date).getTime(),s=function(){var e;e=[];for(i in r)o=r[i],e.push(""+encodeURIComponent(i)+"="+encodeURIComponent(o));return e}(),this.firePixel(""+e+"/"+t+"?"+s.join("&"))},e.prototype.replaceCacheBusterParam=function(e){return e.replace("[timestamp]",(new Date).getTime())},e}()}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};STR.BeaconTunnel.Models.MessageHandler=function(){function t(){this.firePixel=e(this.firePixel,this),this.fireBeacon=e(this.fireBeacon,this),this.initializeTunnel=e(this.initializeTunnel,this),this.handlePostMessage=e(this.handlePostMessage,this),this.handlerFor=e(this.handlerFor,this),window.addEventListener("message",this.handlePostMessage)}return t.prototype.handlerFor=function(e){return{initialize:this.initializeTunnel,beacon:this.fireBeacon,pixel:this.firePixel}[e]},t.prototype.postMessage=function(e){return window.parent.postMessage(JSON.stringify(e),"*")},t.prototype.handlePostMessage=function(e){var t;try{return t=JSON.parse(e.data),this.handlerFor(t.event)(t)}catch(n){}},t.prototype.bootTunnel=function(){return this.postMessage({event:"boot"})},t.prototype.initializeTunnel=function(e){return this.beaconCannon=new STR.BeaconTunnel.Models.BeaconCannon(e.params),this.postMessage({event:"ready",uid:this.beaconCannon.uid})},t.prototype.fireBeacon=function(e){return this.beaconCannon.fireBeacon(e.host,e.resource,e.params)},t.prototype.firePixel=function(e){return this.beaconCannon.firePixel(e.url)},t}()}.call(this),function(){STR.BeaconTunnel.boot=function(){var e;return e=new STR.BeaconTunnel.Models.MessageHandler,e.bootTunnel()},/in/.test(document.readyState)?STR.BeaconTunnel.boot():window.addEventListener("DOMContentLoaded",STR.BeaconTunnel.boot)}.call(this),function(){}.call(this);