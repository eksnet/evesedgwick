GALE.namespace("citationTools");
(function(d,a){var b=function(h,c,b,f){c=a.citationTools.init.getServiceEndpoint()+"rest/cite/bulk/"+c;d.ajax({type:"POST",asynch:void 0===f?!0:f,url:c,contentType:"application/json; charset\x3dutf-8",data:JSON.stringify(h),success:b,error:g})},c=function(){var a=[];d(".citationToolsData").each(function(){var c=d(this).data("docid"),b=d(this).data("mcode"),f=d(this).data("url"),e=d(this).data("productname");a.push({docId:c,mcode:b,documentUrl:f,productName:e})});return a},g=function(){a.citationTools.view.setMlaCitations(["???citationTools.citationUnavailable???"]);
a.citationTools.view.setApaCitations(["???citationTools.citationUnavailable???"])},e={_errorHandle:g,fetchCitationBulkAjax:b,buildDocumentData:c,reset:function(){a.citationTools.view.reset()}};_.extend(a.namespace("citationTools.citation"),{initCitations:function(){e.reset();a.citationTools.view.initCitationPopup();a.citationTools.view.openWindow();var b=c();d.each(b,function(){a.citationTools.view.addDocumentForDownload(this.docId,this.mcode,this.documentUrl,this.productName)});e.fetchCitationBulkAjax(b,
"MLA7",a.citationTools.view.setMlaCitations)},fetchApaCitation:function(){b(c(),"APA",a.citationTools.view.setApaCitations)},fetchEasybibCitation:function(){return b(c(),"EASYBIB",a.citationTools.view.setEasybibCitations,!1)},fetchRisCitation:function(){return b(c(),"RIS",a.citationTools.view.setRisCitations,!1)},internal:e})})(jQuery,GALE);GALE.namespace("citationTools");(function(b,c){_.extend(c.namespace("citationTools.init"),{init:function(){b(".citationToolsButton").bind("click",c.citationTools.citation.initCitations)},getServiceEndpoint:function(){var a=b(".citationToolsSettings").data("serviceendpoint");return a||""===a?a:"citationtools/"}})})(jQuery,GALE);GALE.namespace("citationTools");
(function(d,f){var g=function(c){c.stopPropagation();var a=d(c.target).data("targetid"),b=document;c=b.getElementById(a);var e=d("#"+a),a={};if("ontouchstart"in window||"onmsgesturechange"in window||b.body.createTextRange)e.attr("contenteditable","true"),e.blur(function(){d(this).attr("contenteditable","false")});b.body.createTextRange?(a=document.body.createTextRange(),a.moveToElementText(c),a.select()):window.getSelection?(b=window.getSelection(),a=document.createRange(),a.selectNodeContents(c),
b.removeAllRanges(),b.addRange(a)):e.select()};_.extend(f.namespace("citationTools.select"),{init:function(){d(".citationToolsClickToSelect").bind("click",g)}})})(jQuery,GALE);GALE.namespace("citationTools");
(function(c,e){var d={},h=function(){c("#citation").append("Error")},f=function(a){d=a},g={fetchMessageBundles:function(a){var b=c(".citationToolsSettings").data("language");if(void 0===b||""===b)b="en";b=e.citationTools.init.getServiceEndpoint()+"rest/messages/"+b;c.ajax({type:"GET",url:b,async:!1,contentType:"application/json; charset\x3dutf-8",success:a,error:h})},setMessageBundle:f};_.extend(e.namespace("citationTools.translate"),{init:function(){g.fetchMessageBundles(f)},translateHtml:function(a){return a.replace(/\?\?\?(.*?)\?\?\?/g,
function(a,c){return d[c]})},getMessage:function(a){return d[a]},internal:g})})(jQuery,GALE);GALE.namespace("citationTools");
(function(a,c){var h=function(){a("#citation").append("Error")},g=function(){a(document).trigger("citationtools.dialogopen");a(".citationToolsFormatTabs").tabs("option","active",0);a("#citationToolsMlaTab").focus()},e=function(b,c,d,f){var e=a("\x3cinput\x3e").attr({type:"hidden",name:"documentData"});e.val(JSON.stringify({docId:b,mcode:c,documentUrl:d,productName:f}));return e},d={loadTemplate:function(){var b=c.citationTools.init.getServiceEndpoint()+"templates/popupWindow.html";a.ajax({type:"GET",
url:b,async:!1,success:d.injectTemplate,error:h})},showZotero:function(){(!0===a(".citationToolsSettings").data("showzoterolink")||"true"===a(".citationToolsSettings").data("showzoterolink"))&&a(".citationToolsZoteroLink").show()},addHtmlToBody:function(b){a("body").append(b)},injectTemplate:function(a){a=d.translateTemplate(a);d.addHtmlToBody(a)},setExampleLink:function(){a("#citationToolsExampleLinkMLA").attr("href",c.citationTools.init.getServiceEndpoint()+"help/MLA_help.html");a("#citationToolsExampleLinkAPA").attr("href",
c.citationTools.init.getServiceEndpoint()+"help/APA_help.html")},translateTemplate:function(a){return c.citationTools.translate.translateHtml(a)},doInitCitationPopup:function(){c.citationTools.translate.init();d.loadTemplate();d.createPopup();d.createTabs();d.setDownloadActions();d.setExampleLink();d.addClickToActivateDisclaimerSlideout();d.showZotero();d.bindFetchApaAndEasyBib();c.citationTools.select.init()},createPopup:function(){a(".citationToolsPopupContainer").dialog({title:c.citationTools.translate.getMessage("citationTools.windowTitle"),
dialogClass:"citationDialog",autoOpen:!1,height:"auto",modal:!0,width:885,resizable:!1,open:g})},createTabs:function(){a(".citationToolsFormatTabs").tabs()},setDownloadActions:function(){a("#citationToolsApaDownload, #citationToolsMlaDownload, #citationToolsRisDownload").attr("action",c.citationTools.init.getServiceEndpoint()+"rest/cite/download")},bindFetchApaAndEasyBib:function(){a("#citationToolsApaTab").click(c.citationTools.citation.fetchApaCitation);a("#easyBibSubmitButton").click(function(a){c.citationTools.citation.fetchEasybibCitation();
a.preventDefault()});a("#refWorksSubmitButton").click(function(a){c.citationTools.citation.fetchRisCitation();a.preventDefault()})},addClickToActivateDisclaimerSlideout:function(){a(".citationToolsDisclaimerLink").click(function(){a(".citationToolsDisclaimerContent").toggle("slide",{direction:"up"})})},onDialogOpen:g};_.extend(c.namespace("citationTools.view"),{initCitationPopup:function(){c.citationTools.view.initCitationPopup=function(){};d.doInitCitationPopup()},setMlaCitations:function(b){b=b.join("\x3chr/\x3e");
a("#citationToolsMlaView").html(c.citationTools.translate.translateHtml(b))},setApaCitations:function(b){b=b.join("\x3chr/\x3e");a("#citationToolsApaView").html(c.citationTools.translate.translateHtml(b))},setRisCitations:function(b){b=b.join("\r\n");a("#citationToolsRefWorksExportData").val(b);a("#risForm").submit()},setEasybibCitations:function(b){b="["+b.join()+"]";a("#citationToolsEasyBibExportData").val(b);a("#easyBibForm").submit()},addDocumentForDownload:function(b,c,d,f){a("#citationToolsApaDownload").append(e(b,
c,d,f));a("#citationToolsMlaDownload").append(e(b,c,d,f));a("#citationToolsRisDownload").append(e(b,c,d,f))},openWindow:function(){a(".citationToolsPopupContainer").dialog("open")},reset:function(){a("#citationToolsMlaView").html("");a("#citationToolsApaView").html("");a("#citationToolsRefWorksExportData").val("");a("#citationToolsEasyBibExportData").val("");a("#citationToolsMlaDownload input[name\x3d'documentData']").remove();a("#citationToolsApaDownload input[name\x3d'documentData']").remove();
a("#citationToolsRisDownload input[name\x3d'documentData']").remove()},internal:d})})(jQuery,GALE);